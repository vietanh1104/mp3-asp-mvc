@{
    var data = ViewBag.Data;
    ViewData["Title"] = "Tìm kiếm";
    int type = (int)(ViewData["Type"] ?? 0);
    var nextPageEnable = data.Page == data.TotalPage ? "disabled" : "";
    var previousPageBtnEnable = data.Page > 1 ? "" : "disabled";
    var previousPageLink = $"/home/search?type={ViewData["Type"]}&searchText={ViewData["searchText"]}&page={data.Page - 1}";
    var nextPageLink = $"/home/search?type={ViewData["Type"]}&searchText={ViewData["searchText"]}&page={data.Page + 1}";
    var changePreviousPageLink = $"/home/search?type={ViewData["Type"]}&searchText={ViewData["searchText"]}&page=1";
    var changeNextPageLink = $"/home/search?type={ViewData["Type"]}&searchText={ViewData["searchText"]}&page=1";
    var musicSideBarStyle = type == 0 ? "side-bar-active" : "";
    var authorSideBarStyle = type == 1 ? "side-bar-active" : "";
    var categorySideBarStyle = type == 2 ? "side-bar-active" : "";

    // Cast data.Items to a list type explicitly (assuming it's a List<App.Domain.Entities.Media>)
    var itemsList = data.Items as List<App.Domain.Entities.Media>;
}

<div class="col-10">
    <div class="content-right">
        <div class="right-all allin" href="/home/search?type=0&searchText=@ViewData["searchText"]&page=1">Tất cả</div>
        <div class="right-music" href="/home/search?type=1&searchText=@ViewData["searchText"]&page=1">Ca sĩ</div>
        <div class="right-music" href="/home/search?type=2&searchText=@ViewData["searchText"]&page=1">Podcasts</div>
    </div>

    <div>
        @if (ViewData["searchText"] != null && !string.IsNullOrWhiteSpace(ViewData["searchText"].ToString()))
        {
            <h3 style="text-align:center;">Kết quả tìm kiếm: @ViewData["searchText"]</h3>
        }
        @if (data.TotalItems > 0)
        {
            @if (type == 0) // Displaying Music
            {
                <div class="card-list-container d-flex justify-content-center">
                    @foreach (var item in itemsList.Take(5)) // Now limiting to 5 items after casting
                    {
                        <partial name="./Common/Media/_musicCardTemplatePartial" model=@item />
                    }
                </div>
            }
            else if (type == 1) // Displaying Authors
            {
                <table class="table" style="background-color: white; border-radius: 4px;">
                    <thead>
                        <tr>
                            <th scope="col">Số thứ tự</th>
                            <th scope="col">Tên ca sĩ</th>
                            <th scope="col">Số bài hát</th>
                            <th scope="col">Số lượt nghe</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (var i = 0; i < itemsList.Take(5).Count(); i++) // Limiting to 5 items
                        {
                            var item = itemsList[i];
                            var index = i + 1 + (data.Page - 1) * data.PageSize;
                            <tr>
                                <th scope="row">@index</th>
                                <td>@item.Name</td>
@*                                 <td>@item.NumberOfTracks</td>
                                <td>@item.Views</td> *@
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else // Displaying Categories
            {
                <table class="table" style="background-color: white; border-radius: 4px;">
                    <thead>
                        <tr>
                            <th scope="col">Số thứ tự</th>
                            <th scope="col">Tên thể loại</th>
                            <th scope="col">Số bài hát</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (var i = 0; i < itemsList.Take(5).Count(); i++) // Limiting to 5 items
                        {
                            var item = itemsList[i];
                            var index = i + 1 + (data.Page - 1) * data.PageSize;
                            <tr>
                                <th scope="row">@index</th>
                                <td>@item.Name</td>
                                @* <td>@item.NumberOfTracks</td> *@
                            </tr>
                        }
                    </tbody>
                </table>
            }

            <!-- Pagination -->
            <div class="d-flex justify-content-end g-3" style="gap: 12px;">
                <a href="@previousPageLink" class="page-link rounded-3 @previousPageBtnEnable">
                    <i class="fa-solid fa-backward-step"></i>
                </a>
                <div class="page-link page-number rounded-3 text-black">@data.Page / @data.TotalPage</div>
                <a href="@nextPageLink" class="page-link rounded-3 @nextPageEnable">
                    <i class="fa-solid fa-forward-step"></i>
                </a>
            </div>
        }
        else
        {
            <div style="text-align:center;">Không tìm thấy kết quả nào</div>
        }
    </div>
</div>

<!-- Custom CSS -->
<style>
    .content-right {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .right-all {
        font-size: 16px;
        background-color: white;
        padding: 10px;
        border-radius: 20px;
    }

    .right-music {
        font-size: 16px;
        color: white;
    }

    .right-all, .right-music {
        padding: 10px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

        .right-all:hover, .right-music:hover {
            color: #1DB954;
        }

    .page-link {
        width: 120px;
        text-align: center;
    }

    .page-number {
        width: auto;
        text-align: center;
    }

    a.disabled {
        pointer-events: none;
        cursor: default;
        color: gray;
    }

    .side-bar a {
        background-color: white;
        margin: 1px;
        border-radius: 4px;
        border: 1px solid black;
    }

    .side-bar-active {
        background-color: #9747FF !important;
    }
</style>
